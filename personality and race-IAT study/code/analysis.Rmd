---
title: "Examining the relationship between the big-5 personality facets and implicit racial attitudes"
subtitle: "Data analysing"
author: "Tina Puskaric"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}

# set knit options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# disable scientific notation
options(scipen = 999) 

```

# Dependencies

```{r}

library(tidyverse)
library(knitr)
library(kableExtra)
library(readr)
library(dplyr)
library(janitor)
library(scales)
library(patchwork)
library(ggplot2)
library(patchwork)
library(psych)
library(report)


```
#SET.SEED

```{r}
#I do it at the beginning and for reproducibility

set.seed(333) 

```

# Data
- Exclude participants using the master exclusion variable.
```{r}

data_processed <- read_csv("../data/processed/data_processed.csv")


data_processed_after_exclusions <- data_processed |>
  filter(exclude_participant == "include")


```

# Sample descriptives

## Sample size before exclusions
- Create a table with the total number of participants before exclusions.
```{r}

data_processed |>
  count(name = "n") |>
  kable() |>
  add_header_above(header = c("Sample before exclusions" = 1)) |>
  kable_classic(full_width = FALSE)

```

## Sample size after exclusions
- Create a table with the total number of participants after exclusions.
```{r}

#much less now

data_processed_after_exclusions |>
  count(name = "n") |>
  kable() |>
  add_header_above(header = c("Sample after exclusions" = 1)) |>
  kable_classic(full_width = FALSE)

```

## Demographics tables 
- Create demographics tables that summarise the mean and SD age, and the frequency and percentage of men vs women in the sample. Report the proportion of participants for which each demographics variable was available.

### Age
```{r}

data_processed_after_exclusions |>
  rename(Age = age) |>
  mutate(Age = ifelse(Age %in% c("missing"), "Missing", "Available")) |>
  group_by(Age) %>%
  summarise(n = n()) %>%
  mutate(Percent = paste0(round_half_up((n / sum(n)) * 100, 1), "%")) |>
  kable() |>
  kable_classic(full_width = FALSE)

data_processed_after_exclusions |>
  filter(age != "missing")|>
  mutate(age = as.numeric(age)) |>
  summarise(Mean = mean(age, na.rm = TRUE),
            SD = sd(age, na.rm = TRUE))|>
  mutate_all(.funs = janitor::round_half_up, digits = 1) |>
  kable() |>
  add_header_above(header = c("Age" = 2)) |>
  kable_classic(full_width = FALSE)


#all persons including the missings - interestingly, there is no difference!

# data_processed_after_exclusions |>
#   mutate(age = as.numeric(age)) |>
#   summarise(Mean = mean(age, na.rm = TRUE),
#             SD = sd(age, na.rm = TRUE)) |>
#   mutate_all(.funs = janitor::round_half_up, digits = 1) |>
#   kable() |>
#   add_header_above(header = c("Age" = 2)) |>
#   kable_classic(full_width = FALSE)
# 



```

### Gender
```{r}

data_processed_after_exclusions |>
  rename(Gender = gender) |>
  mutate(Gender = ifelse(Gender %in% c("missing"), "Missing", "Available")) |>
  group_by(Gender) %>%
  summarise(n = n()) %>%
  mutate(Percent = paste0(round_half_up((n / sum(n)) * 100, 1), "%")) |>
  mutate(Gender = stringr::str_to_sentence(Gender))|>
  kable() |>
  kable_classic(full_width = FALSE)

data_processed_after_exclusions |> 
  filter(gender != "missing")|>
  rename(Gender = gender) |>
  group_by(Gender) |> 
  summarise(n = n()) |> 
  mutate(Percent = paste0(round_half_up((n / sum(n)) * 100, 1), "%")) |>
  mutate(Gender = stringr::str_to_sentence(Gender)) |> 
  kable() |>
  kable_classic(full_width = FALSE)

#including the missings - it makes a difference here!
#I left this code visible because 13,7% missing data 


data_processed_after_exclusions |>
  rename(Gender = gender) |>
  group_by(Gender) |>
  summarise(n = n()) |>
  mutate(Percent = paste0(round_half_up((n / sum(n)) * 100, 1), "%")) |>
  mutate(Gender = stringr::str_to_sentence(Gender)) |>
  kable() |>
  kable_classic(full_width = FALSE)



```


# Descriptives BFI & IAT

## Cronbach's Alpha
- Calculate Cronbach's alpha for each of the BFI subscales.

subset or select - it comes to the same thing, I decided on select because with subset the starts_with didn't really wanted to work and I would rather work with starts_with because it is less error-prone than writing out the individual items.

I only output the one table where the raw alpha can be seen, otherwise there will be a lot of code in the HTML.
```{r}

#raw_alpha for Agreeableness: 0.78
alpha_agreeableness <- data_processed_after_exclusions |>
  select(starts_with("bfi_a")) |>
  na.omit() |>
  alpha()

print(alpha_agreeableness$total)


#raw_alpha for Openness: 0.81
alpha_openness <- data_processed_after_exclusions |>
  select(starts_with("bfi_o")) |>
  na.omit() |>
  alpha()

print(alpha_openness$total)


#raw_alpha for Extroversion: 0.82
alpha_extroversion <- data_processed_after_exclusions |>
  select(starts_with("bfi_e")) |>
  na.omit() |>
  alpha()

print(alpha_extroversion$total)


#raw_alpha for Neuroticism: 0.78
alpha_neuroticism <- data_processed_after_exclusions |>
  select(starts_with("bfi_n")) |>
  na.omit() |>
  alpha()

print(alpha_neuroticism$total)


#raw_alpha for Conscientiousness: 0.81
alpha_conscientiousness <- data_processed_after_exclusions |>
  select(starts_with("bfi_c")) |>
  na.omit() |>
  alpha()

print(alpha_conscientiousness$total)


```


## Plots
- Create series of histograms of the distribution of scores on each of the BFI subscales and the IAT.

### IAT Plot

I chose the color green because *Green*wald's D. ;D

I chose theme_minimal because the grid is in the background and I find it helpful. The X axis limit this way because the data ranged from -1 - 0.5 and so you can see cleary it's asymmetric (+ Zero Line).

I made the D in D score in the axis crusive because it is an effect size.I will do the same for the other plots.

```{r}


ggplot(data_processed_after_exclusions, aes(x = D)) +
  geom_vline(xintercept = 0, linetype = "solid", color = "black", size = 0.1) +
  geom_histogram(binwidth = 0.1,
                 boundary = 1,
                 color = "#000000",
                 fill = "#446644",
                 alpha = 0.9) +
  labs(x = expression(paste(bolditalic("D"), bold(" Score"))),
       y = "Frequency",
       title = "Distribution of D Score") +
  scale_x_continuous(breaks = seq(-1, 0.7, by = 0.25), limits = c(-1.1, 0.7)) +
  scale_y_continuous(breaks = pretty_breaks(n = 4), limits = c(0, 23)) +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"),
        axis.text = element_text(size = 10),
        panel.grid.minor = element_blank())


```


### BFI Plots
All plots have the same dimensions, if you want to compare them, it will be easier this way

I created new seperate datasets to avoid the warning that several rows have been removed, also I included D so that I can reuse this dataset for another task.

The colors were chosen so that they stand out enough (and because I like them). 

<span style="color: #D3D3D3; font-size: smaller;"> If I had my way, *every single plot* would be in a yellow variation. :D</span>

#### Agreeableness
```{r}


mean_agree <- data_processed_after_exclusions|>
  select(mean_agreeableness, D)|>
  na.omit()


ggplot(mean_agree, aes(x = mean_agreeableness)) +
  geom_histogram(binwidth = 0.2,
                 boundary = 1,
                 color = "#000000",
                 fill = "#AF5FAF",
                 alpha = 0.9) +
  labs(x = "Mean Agreeableness",
       y = "Frequency",
       title = "Distribution of Agreeableness") +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1,6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 6),  limits = c(0, 17)) 

```


#### Openness
```{r}

mean_open <- data_processed_after_exclusions|>
  select(mean_openness, D)|>
  na.omit()

ggplot(mean_open, aes(x = mean_openness)) +
  geom_histogram(binwidth = 0.2,
                 boundary = 1,
                 color = "#000000",
                 fill = "#FF7F00",
                 alpha = 0.9) +
  labs(x = "Mean Openness",
       y = "Frequency",
       title = "Distribution of Openness") +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1,6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 6),  limits = c(0, 17)) 

```

#### Extroversion
```{r}

mean_extro <- data_processed_after_exclusions|>
  select(mean_extroversion, D)|>
  na.omit()

ggplot(mean_extro, aes(x = mean_extroversion)) +
  geom_histogram(binwidth = 0.2,
                 boundary = 1,
                 color = "#000000",
                 fill = "#E41A1C",
                 alpha = 0.9) +
  labs(x = "Mean Extroversion",
       y = "Frequency",
       title = "Distribution of Extroversion") +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1,6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 6),  limits = c(0, 17))


```

#### Neuroticism
```{r}

mean_neuro <- data_processed_after_exclusions|>
  select(mean_neuroticism, D)|>
  na.omit()


ggplot(mean_neuro, aes(x = mean_neuroticism)) +
  geom_histogram(binwidth = 0.2,
                 boundary = 1,
                 color = "#000000",
                 fill = "#87CEEB",
                 alpha = 0.9) +
  labs(x = "Mean Neuroticism",
       y = "Frequency",
       title = "Distribution of Neuroticism") +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1,6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 6),  limits = c(0, 17))

```

#### Conscientious
```{r}

mean_cons <- data_processed_after_exclusions|>
  select(mean_conscientiousness, D)|>
  na.omit()

ggplot(mean_cons, aes(x = mean_conscientiousness)) +
  geom_histogram(binwidth = 0.2,
                 boundary = 1,
                 color = "#000000",
                 fill = "#27d08b",
                 alpha = 0.9) +
  labs(x = "Mean Conscientiousness",
       y = "Frequency",
       title = "Distribution of Conscientiousness") +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10),
        panel.grid.minor = element_blank()) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1,6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 6),  limits = c(0, 17)) 

```


## Correlation between IAT and BFI
- Create a table with a correlation matrix of the Pearson's r correlations between the IAT and the BFI subscales rounded to two decimal places. 

```{r}

# meanscores_correlations  
data_processed_after_exclusions |>
  select(D, starts_with(c("mean_"))) |>
  cor(method = "pearson", use = "pairwise.complete.obs")|> #only takes values for the correlation if they exist in pairs
  round(2)|>
  kable() |>
  kable_classic(full_width = FALSE)|>
  add_header_above(header = c("Correlation between BFI Scales and IAT" = 7),  align = "left")



# items_correlations - I also wanted to do it out of interest

# data_processed_after_exclusions |>
#   select(D, starts_with(c("bfi_"))) |>
#   cor(use = "pairwise.complete.obs")|>
#   round(2)|>
#   kable() |>
#   kable_classic(full_width = FALSE)|>
#   add_header_above(header = c("Correlation between BFI Items and IAT" = 46),  align = "c") 


```

# Analyses & hypothesis tests

## T Test
- Run a t-test to test the hypothesis that men and women differ on their scores on the IAT. Report and interpret the results using {report}.

*Conclusion*: Since there is no significance, it can be assumed that gender does not influence the IAT score.

I added also the report_table, because i think its also helpful.

I was unsure which scores I should use and also made the T-tests for mean1 and mean2, but stored them in markdowns.

```{r}

#preparing the dataset for the t tests
data_t_test<- data_processed_after_exclusions|>
    filter(gender %in% c("female", "male"))

t_test_D <- t.test(D ~ gender, data = data_t_test)
report_table(t_test_D)
report(t_test_D)
#report and report_text do the same thing in our case here


# t_test_mean1 <- t.test(mean1 ~ gender, data = data_t_test)
# report_table(t_test_mean1)
# report_text(t_test_mean1)
# 
# t_test_mean2 <- t.test(mean2 ~ gender, data = data_t_test)
# report_table(t_test_mean2)
# report_text(t_test_mean2)


```

## Regressions
- Run a series of regressions to test the hypotheses that each BFI subscale predicts IAT scores. Run separate regressions for each subscale rather than a multiple regression. Report and interpret the results using {report}.

I have given all facets their own heading to make it clearer. 

I also used the summary function because I found it helpful.

The Mean1 and Mean2 regressions are in the markdowns.

### Agreeableness
```{r}

# for Agreeableness
regression_agreeableness_D <- lm(D ~ mean_agreeableness, data = data_processed_after_exclusions)
report(regression_agreeableness_D)
summary(regression_agreeableness_D)

# regression_agreeableness_mean1 <- lm(mean1 ~ mean_agreeableness, data = data_processed_after_exclusions)
# regression_agreeableness_mean2 <- lm(mean2 ~ mean_agreeableness, data = data_processed_after_exclusions)
# 
# 
# report(regression_agreeableness_mean1)
# summary(regression_agreeableness_mean1)
# 
# report(regression_agreeableness_mean2)
# summary(regression_agreeableness_mean2)


```

### Openness
```{r}
# for Openness
regression_openness_D <- lm(D ~ mean_openness, data = data_processed_after_exclusions)
report(regression_openness_D)
summary(regression_openness_D)


# regression_openness_mean1 <- lm(mean1 ~ mean_openness, data = data_processed_after_exclusions)
# regression_openness_mean2 <- lm(mean2 ~ mean_openness, data = data_processed_after_exclusions)
# 
# report(regression_openness_mean1)
# summary(regression_openness_mean1)
# 
# report(regression_openness_mean2)
# summary(regression_openness_mean2)


```

### Extroversion
```{r}
# for Extroversion
regression_extroversion_D <- lm(D ~ mean_extroversion, data = data_processed_after_exclusions)
report(regression_extroversion_D)
summary(regression_extroversion_D)

# regression_extroversion_mean1 <- lm(mean1 ~ mean_extroversion, data = data_processed_after_exclusions)
# regression_extroversion_mean2 <- lm(mean2 ~ mean_extroversion, data = data_processed_after_exclusions)
# 
# report(regression_extroversion_mean1)
# summary(regression_extroversion_mean1)
# 
# report(regression_extroversion_mean2)
# summary(regression_extroversion_mean2)


```

### Neuroticism
```{r}
# for Neuroticism

regression_neuroticism_D <- lm(D ~ mean_neuroticism, data = data_processed_after_exclusions)
report(regression_neuroticism_D)
summary(regression_neuroticism_D)


# regression_neuroticism_mean1 <- lm(mean1 ~ mean_neuroticism, data = data_processed_after_exclusions)
# regression_neuroticism_mean2 <- lm(mean2 ~ mean_neuroticism, data = data_processed_after_exclusions)
# 
# report(regression_neuroticism_mean1)
# summary(regression_neuroticism_mean1)
# 
# report(regression_neuroticism_mean2)
# summary(regression_neuroticism_mean2)

```

### Conscientiousness
```{r}
# for Conscientiousness

regression_conscientiousness_D <- lm(D ~ mean_conscientiousness, data = data_processed_after_exclusions)
report(regression_conscientiousness_D)
summary(regression_conscientiousness_D)

# regression_conscientiousness_mean1 <- lm(mean1 ~ mean_conscientiousness, data = data_processed_after_exclusions)
# regression_conscientiousness_mean2 <- lm(mean2 ~ mean_conscientiousness, data = data_processed_after_exclusions)
# 
# report(regression_conscientiousness_mean1)
# summary(regression_conscientiousness_mean1)
# 
# report(regression_conscientiousness_mean2)
# summary(regression_conscientiousness_mean2)


```


# BFI Scatter Plots

- Create series of scatter plots of how BFI subscale scores predict IAT scores. Add regression lines. These plots therefore illustrate the same results as the regressions above. Make the plots presentable and publication quality- you may decide the details of this with one exception: Extreme scores on the IAT (defined as participants whose scores in the top and bottom 10% of IAT scores) should use a triangular shape rather than a dot. 


## Single Plots

I use the data set from the previous task where we had to create plots so that I don't get an unnecessary error warning. Also I created a new Variable for the top and bottom D Scores. 

I chose the Theme_Classic because in most publications the background is blank and everything is kept very minimalistic.

I used light vs dark color so that colorblind people can see the contrast, along with the shape.

In publications it's not common to bold titles (at least APA says that) like that, but you said we have freedom as long as it's presentable and I think bold titles make it presentable. :)

The limits are set a little wider so that the points can be displayed well and are not possibly cut off.

For the X axis, I chose values from 1 to 6 because these are the boundaries and we represented the data from 1 to 6. I chose the values -1 to 0.5 for the Y axis because a larger bandwidth would result in too much white space and it would not be necessary because all data can be successfully mapped in this way. In addition, I added a zero line for the Y axis to emphasize the asymmetric distribution of the data.

I didn't label all the ticks on the Y axis because I wanted to find a balance between the HTML output and PNGs. If I had left all the ticks labeled, it wouldn't have looked as nice in the document and HTML. As it is, the unlabeled ticks are still helpful and serve their purpose. 

I have used the same dimensions for all scatterplots so that they remain comparable in the combined plot.

### Agreeableness
```{r}

# for Agreeableness


mean_agree$extreme <- ifelse(mean_agree$D >= quantile(mean_agree$D, 0.9) |
                               mean_agree$D <= quantile(mean_agree$D, 0.1),
                     "extreme", "not extreme")

plot_agree <- ggplot(mean_agree, aes(x = mean_agreeableness, y = D)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "darkgrey", size = 0.05) +
  geom_point(size = 1.5, alpha = 0.7, aes(fill = extreme, shape = extreme), position = "jitter") +
  scale_shape_manual(values = c("not extreme" = 16, "extreme" = 24),
                     name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                     labels = c("Top or Bottom 10%", "Not Extreme")) +
  scale_fill_manual(values = c("not extreme" = "#000000", "extreme" = "#fb75fb"),
                    name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                    labels = c("Top or Bottom 10%", "Not Extreme")) +
  geom_smooth(method = "lm", color = "#f915f9", se = TRUE) +
  labs(x = "Mean Agreeableness",
       y = expression(paste(bolditalic("D"), bold(" Score"))),
       title = expression(paste(bold("Scatter Plot of Agreeableness Predicting the "),
                                           bolditalic("D"), bold(" Score")))) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1, 6.2)) +
  scale_y_continuous(breaks = c(-1, -0.75, -0.5, -0.25, 0, 0.25, 0.5),  limits = c(-1, 0.5),
                     labels = c(-1, "", -0.5, "", 0, "", 0.5)) +
  expand_limits(x = c(1, 6), y = c(-1, 1)) +
  coord_cartesian(expand = FALSE) +
  theme_classic()+
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold")) 
                     
print(plot_agree)

```

### Openness
```{r}
# for Openness

mean_open$extreme <- ifelse(mean_open$D >= quantile(mean_open$D, 0.9) |
                               mean_open$D <= quantile(mean_open$D, 0.1),
                     "extreme", "not extreme")

plot_open <- ggplot(mean_open, aes(x = mean_openness, y = D)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "darkgrey", size = 0.05) +
  geom_point(size = 1.5, alpha = 0.7, aes(fill = extreme, shape = extreme), position = "jitter") +
  scale_shape_manual(values = c("not extreme" = 16, "extreme" = 24),
                     name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                     labels = c("Top or Bottom 10%", "Not Extreme")) +
  scale_fill_manual(values = c("not extreme" = "#000000", "extreme" = "#FFBF00"),
                    name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                    labels = c("Top or Bottom 10%", "Not Extreme")) +
  geom_smooth(method = "lm", color = "#FF5733", se = TRUE) +
  labs(x = "Mean Openness",
       y = expression(paste(bolditalic("D"), bold(" Score"))),
       title = expression(paste(bold("Scatter Plot of Openness Predicting the "),
                                           bolditalic("D"), bold(" Score")))) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1, 6.2)) +
  scale_y_continuous(breaks = c(-1, -0.75, -0.5, -0.25, 0, 0.25, 0.5),  limits = c(-1, 0.5),
                     labels = c(-1, "", -0.5, "", 0, "", 0.5)) +
  expand_limits(x = c(1, 6), y = c(-1, 1)) +
  coord_cartesian(expand = FALSE) +
  theme_classic() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10)) 

print(plot_open)

```

### Extroversion
```{r}
# for Extroversion

mean_extro$extreme <- ifelse(mean_extro$D >= quantile(mean_extro$D, 0.9) |
                               mean_extro$D <= quantile(mean_extro$D, 0.1),
                     "extreme", "not extreme")

plot_extro <- ggplot(mean_extro, aes(x = mean_extroversion, y = D)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "darkgrey", size = 0.05) +
  geom_point(size = 1.5, alpha = 0.7, aes(fill = extreme, shape = extreme), position = "jitter") +
  scale_shape_manual(values = c("not extreme" = 16, "extreme" = 24),
                     name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                     labels = c("Top or Bottom 10%", "Not Extreme")) +
  scale_fill_manual(values = c("not extreme" = "#000000", "extreme" = "#ed5e5f"),
                    name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                    labels = c("Top or Bottom 10%", "Not Extreme")) +
  geom_smooth(method = "lm", color = "#f80609", se = TRUE) +
  labs(x = "Mean Extroversion",
       y = expression(paste(bolditalic("D"), bold(" Score"))),
       title = expression(paste(bold("Scatter Plot of Extroversion Predicting the "),
                                           bolditalic("D"), bold(" Score")))) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1, 6.2)) +
  scale_y_continuous(breaks = c(-1, -0.75, -0.5, -0.25, 0, 0.25, 0.5),  limits = c(-1, 0.5),
                     labels = c(-1, "", -0.5, "", 0, "", 0.5)) +
  expand_limits(x = c(1, 6), y = c(-1, 1)) +
  coord_cartesian(expand = FALSE) +
  theme_classic() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10))

print(plot_extro)



```

### Neuroticism
```{r}
# for Neuroticism

mean_neuro$extreme <- ifelse(mean_neuro$D >= quantile(mean_neuro$D, 0.9) |
                               mean_neuro$D <= quantile(mean_neuro$D, 0.1),
                     "extreme", "not extreme")

plot_neuro <- ggplot(mean_neuro, aes(x = mean_neuroticism, y = D)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "darkgrey", size = 0.05) +
  geom_point(size = 1.5, alpha = 0.7, aes(fill = extreme, shape = extreme), position = "jitter") +
  scale_shape_manual(values = c("not extreme" = 16, "extreme" = 24),
                     name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                     labels = c("Top or Bottom 10%", "Not Extreme")) +
  scale_fill_manual(values = c("not extreme" = "#000000", "extreme" = "#87CEEB"),
                    name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                    labels = c("Top or Bottom 10%", "Not Extreme")) +
  geom_smooth(method = "lm", color = "#1a1ce4", se = TRUE) +
  labs(x = "Mean Neuroticism",
       y = expression(paste(bolditalic("D"), bold(" Score"))),
       title = expression(paste(bold("Scatter Plot of Neuroticism Predicting the "),
                                           bolditalic("D"), bold(" Score")))) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1, 6.2)) +
  scale_y_continuous(breaks = c(-1, -0.75, -0.5, -0.25, 0, 0.25, 0.5),  limits = c(-1, 0.5),
                     labels = c(-1, "", -0.5, "", 0, "", 0.5)) +
  expand_limits(x = c(1, 6), y = c(-1, 1)) +
  coord_cartesian(expand = FALSE) +
  theme_classic() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10)) 

print(plot_neuro)



```

### Conscientiousness
```{r}
# for Conscientiousness

mean_cons$extreme <- ifelse(mean_cons$D >= quantile(mean_cons$D, 0.9) |
                               mean_cons$D <= quantile(mean_cons$D, 0.1),
                     "extreme", "not extreme")

plot_cons <- ggplot(mean_cons, aes(x = mean_conscientiousness, y = D)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "darkgrey", size = 0.05)+
  geom_point(size = 1.5, alpha = 0.7, aes(fill = extreme, shape = extreme), position = "jitter") +
  scale_shape_manual(values = c("not extreme" = 16, "extreme" = 24),
                     name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                     labels = c("Top or Bottom 10%", "Not Extreme")) +
  scale_fill_manual(values = c("not extreme" = "#000000", "extreme" = "#27d08b"),
                    name = expression(paste(bold("Extreme "),bolditalic("D"), bold(" Score"))),
                    labels = c("Top or Bottom 10%", "Not Extreme")) +
  geom_smooth(method = "lm", color = "#00757b", se = TRUE) +
  labs(x = "Mean Conscientiousness",
       y = expression(paste(bolditalic("D"), bold(" Score"))),
       title = expression(paste(bold("Scatter Plot of Conscientiousness Predicting the "),
                                           bolditalic("D"), bold(" Score")))) +
  scale_x_continuous(breaks = pretty_breaks(n = 6), limits = c(1, 6.2)) +
  scale_y_continuous(breaks = c(-1, -0.75, -0.5, -0.25, 0, 0.25, 0.5),  limits = c(-1, 0.5),
                     labels = c(-1, "", -0.5, "", 0, "", 0.5)) +
  expand_limits(x = c(1, 6), y = c(-1, 1)) +
  coord_cartesian(expand = FALSE) +
  theme_classic() +
  theme(title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"), 
        axis.text = element_text(size = 10)) 

print(plot_cons)


```




## BFI Plots combining

- A single combined plot should be created, containing 5 component plots, with the personality facet being examined in each clearly labelled. This plot should be printed in the html file but also saved to disk as both png/pdf.
- Combine these scatter plots into one ggplot object using {patchwork} and print the combined plot in your .Rmd and .html. 

I think this is the same task?

```{r}

#I chose this layout because I like it 
#and wanted to experiment with it
layout <- "
A#B
#C#
D#E
"

#seperate guide, so that the same guide does not appear five times in different colors
plot_guide <- ggplot(mean_cons, aes(x = mean_conscientiousness, y = D)) +
  geom_point(size = 1.5, alpha = 0.7, aes(shape = extreme)) +
  scale_shape_manual(values = c("not extreme" = 16, "extreme" = 24),
                     name = expression(paste(bolditalic("D"), bold(" Score"))),
                     labels = c("Top or Bottom 10%", "Not Extreme"))

#Place Z in the layout does not exist, 
#so the plot that I only created because of the guide will be dropped 
#-> the legend is kept
plot_temp <- wrap_plots(A = plot_agree + labs(title = "Agreeableness") + theme(legend.position = "none"),
                   B = plot_open + labs(title = "Openness") + theme(legend.position = "none"), 
                   C = plot_extro + labs(title = "Extroversion") + theme(legend.position = "none"), 
                   D = plot_neuro + labs(title = "Neuroticism") + theme(legend.position = "none"), 
                   E = plot_cons + labs(title = "Conscientiousness") + theme(legend.position = "none"),
                   Z = plot_guide,
                   design = layout) +
  theme_classic()


plot_comb_bfi <- plot_temp + 
  plot_layout(guides = 'collect', design = layout) &
  theme(axis.title = element_text(face = "plain"),
        legend.title = element_text(face = "bold"))  &
  plot_annotation(title =  "Scatter Plots with Regressions for BFI Subscales Predicting the D Score",
                  theme = theme(plot.title = element_text(face = "bold"))) 

plot_comb_bfi <- plot_temp + 
  plot_layout(guides = 'collect', design = layout) +
  theme(axis.title = element_text(face = "plain"),
        legend.title = element_text(face = "bold"),
        plot.title = element_text(face = "bold")) +
  plot_annotation(title = expression(paste(bold("Scatter Plots with Regressions for BFI Subscales Predicting the "),
                                           bolditalic("D"), bold(" Score"))),
                  theme = theme(plot.title = element_text(face = "bold")))




#its not pretty here as a pronmt(), but if you open the png or pdf, it's in a much butter resolution
#the one warning can be ignored, it refers to the plot_guide, this was on purpose
#it's funny how the zero line looks different in html, rmd and in png 
print(plot_comb_bfi)


```

### Saving plot
- Save the combined plot to disk as a .pdf and .png in the "communications" folder. 

I have adjusted the size so that the plots are better displayed.
```{r}


ggsave("../communications/plot_comb_bfi.png", plot = plot_comb_bfi,  width = 16, height = 10, dpi = 300, device = "png")

ggsave("../communications/plot_comb_bfi.pdf", plot = plot_comb_bfi,width = 16, height = 10, device = "pdf")


```

# Session info

```{r}

sessionInfo()


```



